<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'nonce-OGY1ZmVhYWEtOGRlNy00YjRhLTk4NzEtNjY2OWU2MGNiN2Y2' 'strict-dynamic' 'unsafe-eval';
        img-src 'self' blob: data: https://assets.grok.com https://imgs.search.brave.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self' https://api.grok.com;
    ">
    <title>Nepali Calendar 2082</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#d32f2f;--secondary:#0288d1;--accent:#fbc02d;--bg:#f5f5f5;--card-bg:#fff;--text:#212121;--text-light:#757575}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
        .header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;text-align:center;padding:1.5rem;font-size:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,0.2);position:relative}
        .month-tabs{display:flex;overflow-x:auto;background:var(--card-bg);padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin:1rem 0}
        .month-tab{padding:0.5rem 1rem;margin:0.5rem;cursor:pointer;border-radius:25px;background:#e3f2fd;font-weight:500;font-size:0.9rem;transition:.3s}
        .month-tab.active{background:var(--secondary);color:#fff;transform:scale(1.05)}
        .month-tab:hover{background:#bbdefb;transform:scale(1.03)}
        .month-tab.nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .nav-buttons{position:absolute;top:50%;transform:translateY(-50%);display:flex;gap:0.5rem}
        .nav-buttons.left{left:1rem}.nav-buttons.right{right:1rem}
        .nav-buttons button{background:#fff;color:var(--secondary);border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;transition:.3s}
        .nav-buttons button:hover{background:var(--accent);color:var(--text)}
        .nav-buttons button:disabled{background:#ddd;cursor:not-allowed}
        .calendar-container{max-width:1600px;margin:2rem auto;padding:1.5rem;background:var(--card-bg);border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.1);display:grid;grid-template-columns:1fr 2fr 1fr;gap:96px}
        .mini-calendar,.main-calendar{width:100%;max-width:300px}
        .main-calendar{max-width:600px}
        .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:0.5rem;text-align:center}
        .mini-calendar .calendar-grid{gap:0.2rem}
        .calendar-day{background:#fff;border:1px solid #e0e0e0;padding:0.75rem;cursor:pointer;min-height:100px;border-radius:8px;transition:.3s;position:relative}
        .mini-calendar .calendar-day{padding:0.2rem;min-height:30px;font-size:0.5rem}
        .calendar-day:hover{background:#f5f5f5;transform:translateY(-2px)}
        .saturday{background:#b0bec5;color:#fff}.dashain{background:#d81b60;color:#fff}.tihar{background:#7b1fa2;color:#fff}
        .national{background:#4caf50;color:#fff}.ethnic{background:#ff9800;color:#fff}.women{background:#f06292;color:#fff}
        .education{background:#0288d1;color:#fff}.jatra{background:#ab47bc;color:#fff}.observed{background:#689f38;color:#fff}
        .disability{background:#26a69a;color:#fff}.birth{background:#ef6c00;color:#fff}
        .bs-date{font-weight:600;font-size:1rem;margin-bottom:0.2rem}.mini-calendar .bs-date{font-size:0.5rem}
        .greg-date{font-size:0.7rem;color:var(--text-light);margin-bottom:0.2rem}.mini-calendar .greg-date{font-size:0.4rem}
        .festival{font-size:0.65rem;margin-top:0.2rem;font-family:'Noto Sans Devanagari',sans-serif}
        .festival-tooltip,.note-tooltip{display:none;position:absolute;background:var(--text);color:#fff;padding:0.5rem;border-radius:6px;font-size:0.7rem;z-index:100;top:-2rem;left:50%;transform:translateX(-50%);white-space:nowrap}
        .mini-calendar .festival-tooltip,.mini-calendar .note-tooltip{font-size:0.4rem;top:-1rem}
        .calendar-day:hover .festival-tooltip,.calendar-day:hover .note-tooltip{display:block}
        .note-indicator{position:absolute;top:0.4rem;right:0.4rem;width:8px;height:8px;background:var(--secondary);border-radius:50%}
        .mini-calendar .note-indicator{top:0.2rem;right:0.2rem;width:5px;height:5px}
        .footnote{margin-top:1rem;padding:1rem;background:var(--card-bg);border-top:1px solid #e0e0e0}
        .footnote h3{font-size:1rem;margin-bottom:0.5rem;color:var(--primary)}
        .footnote ul{list-style:none;font-size:0.8rem}.footnote li{margin-bottom:0.2rem}
        .footnote .nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .note-form-container{position:fixed;bottom:0;left:0;width:100%;background:var(--card-bg);box-shadow:0 -4px 12px rgba(0,0,0,0.1);padding:1.5rem;display:none;z-index:1000}
        .note-form-container.active{display:block}
        .note-form-container h3{margin:0 0 1rem;font-size:1.1rem;color:var(--primary)}
        .note-form-container input,.note-form-container textarea{width:100%;margin-bottom:1rem;padding:0.75rem;border:1px solid #ddd;border-radius:8px;font-family:'Poppins',sans-serif;font-size:0.9rem}
        .note-form-container button{background:var(--secondary);color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:600;transition:.3s}
        .note-form-container button:hover{background:#0277bd}
        .note-form-container .nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .notes-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:2000}
        .notes-modal-content{background:var(--card-bg);margin:10% auto;padding:1.5rem;width:90%;max-width:600px;border-radius:12px;position:relative}
        .notes-modal-content h2{margin:0 0 1rem;color:var(--primary);font-size:1.3rem}
        .notes-modal-content .nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .close-modal{position:absolute;top:1rem;right:1rem;font-size:1.5rem;cursor:pointer;color:var(--text-light)}
        .filter-section{margin-bottom:1rem}
        .filter-section select,.filter-section input[type="file"]{padding:0.75rem;border-radius:8px;border:1px solid #ddd;width:100%;max-width:200px;font-family:'Poppins',sans-serif;font-size:0.9rem}
        .filter-section select.nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .notes-list{max-height:300px;overflow-y:auto;margin-bottom:1rem}
        .note-item{border-bottom:1px solid #eee;padding:0.75rem 0;position:relative}
        .note-item:last-child{border-bottom:none}
        .note-actions{position:absolute;top:0.75rem;right:0;display:flex;gap:0.5rem}
        .edit-note,.delete-note{cursor:pointer;font-size:0.8rem}
        .edit-note{color:var(--secondary)}.edit-note:hover{color:#0277bd}
        .delete-note{color:var(--primary)}.delete-note:hover{color:#b71c1c}
        .action-buttons{display:flex;flex-wrap:wrap;gap:0.75rem;justify-content:space-between}
        .export-btn,.clear-btn,.print-btn,.calendar-export-btn,.calendar-import-btn{border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:600}
        .export-btn,.calendar-export-btn{background:#4caf50;color:#fff}
        .export-btn:hover,.calendar-export-btn:hover{background:#388e3c}
        .clear-btn{background:var(--primary);color:#fff}
        .clear-btn:hover{background:#b71c1c}
        .print-btn{background:#0288d1;color:#fff}
        .print-btn:hover{background:#0277bd}
        .calendar-import-btn{background:#fbc02d;color:var(--text)}
        .calendar-import-btn:hover{background:#f9a825}
        .access-notes-btn{position:fixed;top:1.5rem;right:1.5rem;background:var(--secondary);color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;z-index:1000;transition:.3s;font-size:0.9rem}
        .access-notes-btn:hover{background:#0277bd}
        .access-notes-btn.nepali{font-family:'Noto Sans Devanagari',sans-serif}
        .language-toggle{position:fixed;top:1.5rem;left:1.5rem;z-index:1000}
        .language-toggle button{background:var(--secondary);color:#fff;border:none;padding:0.75rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.9rem}
        .language-toggle button:hover{background:#0277bd}
        .footer{text-align:center;padding:1rem;background:var(--card-bg);color:var(--text-light);font-size:0.8rem;margin-top:2rem;box-shadow:0 -2px 8px rgba(0,0,0,0.1)}
        @media (max-width:768px){
            .header{font-size:1.2rem}
            .month-tab{padding:0.4rem 0.8rem;font-size:0.8rem}
            .calendar-day{min-height:80px}
            .nav-buttons{flex-direction:column}
            .calendar-container{grid-template-columns:1fr;grid-template-rows:auto auto auto;gap:1rem}
            .mini-calendar,.main-calendar{max-width:100%}
        }
    </style>
</head>
<body>
    <div class="language-toggle">
        <button id="languageToggle" data-en="Toggle Language (EN/NE)" data-ne="भाषा टगल गर्नुहोस् (EN/NE)">Toggle Language (EN/NE)</button>
    </div>
    <div class="header">
        <span class="header-title" data-en="Nepali Calendar" data-ne="नेपाली पात्रो">Nepali Calendar</span> - <span id="currentMonth">2082 BS</span>
        <div class="nav-buttons left">
            <button id="prevMonth" data-en="Previous" data-ne="अघिल्लो">Previous</button>
        </div>
        <div class="nav-buttons right">
            <button id="nextMonth" data-en="Next" data-ne="पछिल्लो">Next</button>
        </div>
    </div>
    <div class="month-tabs" id="monthTabs"></div>
    <button class="access-notes-btn" id="accessNotes" data-en="View Notes" data-ne="नोटहरू हेर्नुहोस्">View Notes</button>
    <div class="calendar-container">
        <div class="mini-calendar" id="miniCalendarLeft">
            <h3 id="miniLeftTitle"></h3>
            <div class="calendar-grid" id="miniCalendarGridLeft"></div>
        </div>
        <div class="main-calendar">
            <div class="calendar-grid" id="calendarGrid"></div>
            <div class="footnote">
                <h3 data-en="Holidays this Month" data-ne="यस महिनाका बिदाहरू">Holidays this Month</h3>
                <ul id="holidayList"></ul>
            </div>
        </div>
        <div class="mini-calendar" id="miniCalendarRight">
            <h3 id="miniRightTitle"></h3>
            <div class="calendar-grid" id="miniCalendarGridRight"></div>
        </div>
    </div>
    <div class="note-form-container" id="noteForm">
        <h3><span data-en="Add Note for" data-ne="नोट थप्नुहोस्">Add Note for</span> <span id="selectedDate">Date</span></h3>
        <input type="text" id="noteTitle" placeholder="Note Title">
        <input type="time" id="noteTime">
        <textarea id="noteDescription" placeholder="Description" rows="3"></textarea>
        <button id="saveNote" data-en="Save Note" data-ne="नोट बचत गर्नुहोस्">Save Note</button>
    </div>
    <div class="notes-modal" id="notesModal">
        <div class="notes-modal-content">
            <span class="close-modal" id="closeModal">×</span>
            <h2 data-en="Saved Notes" data-ne="बचत गरिएका नोटहरू">Saved Notes</h2>
            <div class="filter-section">
                <select id="monthFilter">
                    <option value="all" data-en="All Months" data-ne="सबै महिनाहरू">All Months</option>
                </select>
                <input type="file" id="calendarImport" accept=".xlsx">
            </div>
            <div class="notes-list" id="notesList"></div>
            <div class="action-buttons">
                <button class="export-btn" id="exportNotes" data-en="Export Notes to Excel" data-ne="नोटहरू एक्सेलमा निर्यात गर्नुहोस्">Export Notes to Excel</button>
                <button class="print-btn" id="printMonth" data-en="Print Month to PDF" data-ne="महिना पीडीएफमा प्रिन्ट गर्नुहोस्">Print Month to PDF</button>
                <button class="print-btn" id="printYear" data-en="Print Year to PDF" data-ne="वर्ष पीडीएफमा प्रिन्ट गर्नुहोस्">Print Year to PDF</button>
                <button class="calendar-export-btn" id="exportMonth" data-en="Export Month to Excel" data-ne="महिना एक्सेलमा निर्यात गर्नुहोस्">Export Month to Excel</button>
                <button class="calendar-export-btn" id="exportYear" data-en="Export Year to Excel" data-ne="वर्ष एक्सेलमा निर्यात गर्नुहोस्">Export Year to Excel</button>
                <button class="clear-btn" id="clearNotes" data-en="Clear All Notes" data-ne="सबै नोटहरू मेटाउनुहोस्">Clear All Notes</button>
            </div>
        </div>
    </div>
    <div class="footer">Calendar Concept and Design by Santosh Phuyal</div>
    <script nonce="OGY1ZmVhYWEtOGRlNy00YjRhLTk4NzEtNjY2OWU2MGNiN2Y2">
        // Assume SheetJS and jsPDF are hosted locally at /scripts/
        // Download from https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.20.2/xlsx.full.min.js
        // and https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js
        const scripts = [
            '/scripts/xlsx.full.min.js',
            '/scripts/jspdf.umd.min.js'
        ];
        scripts.forEach(src => {
            const script = document.createElement('script');
            script.src = src;
            script.async = false;
            document.head.appendChild(script);
        });

        // Calendar data
        const calendarData = {
            2081: [{name:"Baishakh",days:31,gregStart:"2024-04-13"},{name:"Jestha",days:32,gregStart:"2024-05-14"},{name:"Ashadh",days:31,gregStart:"2024-06-15"},{name:"Shrawan",days:32,gregStart:"2024-07-16"},{name:"Bhadra",days:31,gregStart:"2024-08-17"},{name:"Asoj",days:31,gregStart:"2024-09-17"},{name:"Kartik",days:30,gregStart:"2024-10-18"},{name:"Mangsir",days:29,gregStart:"2024-11-17"},{name:"Poush",days:30,gregStart:"2024-12-16"},{name:"Magh",days:29,gregStart:"2025-01-15"},{name:"Falgun",days:30,gregStart:"2025-02-13"},{name:"Chaitra",days:30,gregStart:"2025-03-15"}],
            2082: [{name:"Baishakh",days:31,gregStart:"2025-04-14"},{name:"Jestha",days:31,gregStart:"2025-05-15"},{name:"Ashadh",days:32,gregStart:"2025-06-15"},{name:"Shrawan",days:31,gregStart:"2025-07-17"},{name:"Bhadra",days:31,gregStart:"2025-08-17"},{name:"Asoj",days:31,gregStart:"2025-09-17"},{name:"Kartik",days:30,gregStart:"2025-10-18"},{name:"Mangsir",days:29,gregStart:"2025-11-17"},{name:"Poush",days:30,gregStart:"2025-12-16"},{name:"Magh",days:29,gregStart:"2026-01-15"},{name:"Falgun",days:30,gregStart:"2026-02-13"},{name:"Chaitra",days:31,gregStart:"2026-03-16"}],
            2083: [{name:"Baishakh",days:31,gregStart:"2026-04-16"},{name:"Jestha",days:32,gregStart:"2026-05-17"},{name:"Ashadh",days:31,gregStart:"2026-06-18"},{name:"Shrawan",days:32,gregStart:"2026-07-19"},{name:"Bhadra",days:31,gregStart:"2026-08-20"},{name:"Asoj",days:31,gregStart:"2026-09-20"},{name:"Kartik",days:30,gregStart:"2026-10-21"},{name:"Mangsir",days:29,gregStart:"2026-11-20"},{name:"Poush",days:30,gregStart:"2026-12-19"},{name:"Magh",days:30,gregStart:"2027-01-18"},{name:"Falgun",days:30,gregStart:"2027-02-17"},{name:"Chaitra",days:30,gregStart:"2027-03-19"}]
        };

        // Festival data
        const festivals = {
            "2082-01-06":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-01-13":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-01-20":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-01-27":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-02-03":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-02-10":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-02-17":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-02-24":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-02-31":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-03-07":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-03-14":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-03-21":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-03-28":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-04-03":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-04-10":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-04-17":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-04-24":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-04-30":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-05-07":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-05-14":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-05-21":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-05-28":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-06-04":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-06-11":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-06-18":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-06-25":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-07-01":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-07-08":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-07-15":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-07-22":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-07-29":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-08-06":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-08-13":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-08-20":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-08-27":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-09-05":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-09-12":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-09-19":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-09-26":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-10-03":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-10-10":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-10-17":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-10-24":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-11-02":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-11-09":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-11-16":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-11-23":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-11-30":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-12-07":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-12-14":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-12-21":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-12-28":{name:"Saturday (Weekly Holiday)",class:"saturday"},"2082-06-13":{name:"Dashain",class:"dashain"},"2082-06-14":{name:"Dashain",class:"dashain"},"2082-06-15":{name:"Dashain (Vijaya Dashami)",class:"dashain"},"2082-06-16":{name:"Dashain",class:"dashain"},"2082-06-17":{name:"Dashain",class:"dashain"},"2082-06-18":{name:"Dashain",class:"dashain"},"2082-07-03":{name:"Tihar",class:"tihar"},"2082-07-04":{name:"Tihar",class:"tihar"},"2082-07-05":{name:"Tihar (Deepawali)",class:"tihar"},"2082-07-06":{name:"Tihar",class:"tihar"},"2082-07-07":{name:"Tihar",class:"tihar"},"2082-01-01":{name:"New Year",class:"national"},"2082-01-05":{name:"Ram Navami",class:"national"},"2082-01-29":{name:"Ubauli Parva (Kirant Community), Buddha Jayanti",class:"national"},"2082-04-24":{name:"Rakshya Bandhan",class:"national"},"2082-04-30":{name:"Krishna Janmashtami",class:"national"},"2082-06-06":{name:"Ghatasthapana",class:"national"},"2082-07-10":{name:"Chhath",class:"national"},"2082-08-18":{name:"Udhauli Parva, Yomari Punhi",class:"national"},"2082-09-10":{name:"Christmas",class:"national"},"2082-09-15":{name:"Tamu Lhosar",class:"national"},"2082-10-01":{name:"Maghe Sankranti",class:"national"},"2082-10-05":{name:"Sonam Lhosar",class:"national"},"2082-11-03":{name:"Maha Shivaratri",class:"national"},"2082-11-06":{name:"Gyalpo Lhosar",class:"national"},"2082-11-18":{name:"Fagu Purnima (56 Districts)",class:"national"},"2082-12-01":{name:"Fagu Purnima (Remaining Districts)",class:"national"},"2082-04-25":{name:"Gai Jatra (Newars, Kathmandu Valley)",class:"jatra"},"2082-05-15":{name:"Gaura Parva",class:"ethnic"},"2082-05-10":{name:"Haritalika (Teej)",class:"women"},"2082-05-30":{name:"Jitiya Festival",class:"women"},"2082-10-09":{name:"Basanta Panchami",class:"education"},"2082-05-21":{name:"Indra Jatra",class:"jatra"},"2082-12-04":{name:"Ghode Jatra",class:"jatra"},"2082-01-18":{name:"May Day",class:"observed"},"2082-02-15":{name:"Republic Day",class:"observed"},"2082-06-03":{name:"Constitution Day",class:"observed"},"2082-10-16":{name:"Martyrs Day",class:"observed"},"2082-11-07":{name:"Democracy Day",class:"observed"},"2082-11-24":{name:"International Women's Day",class:"observed"},"2082-08-17":{name:"International Day of Persons with Disabilities",class:"disability"},"2082-07-25":{name:"Falgunanda Jayanti (Kirants)",class:"birth"},"2082-09-27":{name:"Prithvi Jayanti",class:"birth"}
        };

        // State
        let currentYear = 2082, currentMonth = 0, language = 'en';
        let notes = JSON.parse(localStorage.getItem('notes')) || [];

        // Language translations
        const translations = {
            months: {
                Baishakh: "बैशाख", Jestha: "जेठ", Ashadh: "असार", Shrawan: "साउन", Bhadra: "भदौ", Asoj: "असोज",
                Kartik: "कार्तिक", Mangsir: "मंसिर", Poush: "पुस", Magh: "माघ", Falgun: "फागुन", Chaitra: "चैत"
            },
            festivals: {
                "Saturday (Weekly Holiday)": "शनिबार (साप्ताहिक बिदा)", "Dashain": "दशैं", "Dashain (Vijaya Dashami)": "दशैं (विजया दशमी)",
                "Tihar": "तिहार", "Tihar (Deepawali)": "तिहार (दीपावली)", "New Year": "नयाँ वर्ष", "Ram Navami": "राम नवमी",
                "Ubauli Parva (Kirant Community), Buddha Jayanti": "उबौली पर्व (किराँत समुदाय), बुद्ध जयन्ती",
                "Rakshya Bandhan": "रक्षा बन्धन", "Krishna Janmashtami": "कृष्ण जन्माष्टमी", "Ghatasthapana": "घटस्थापना",
                "Chhath": "छठ", "Udhauli Parva, Yomari Punhi": "उधौली पर्व, योमरी पूर्णिमा", "Christmas": "क्रिसमस",
                "Tamu Lhosar": "तमु ल्होसार", "Maghe Sankranti": "माघे संक्रान्ति", "Sonam Lhosar": "सोनम ल्होसार",
                "Maha Shivaratri": "महाशिवरात्रि", "Gyalpo Lhosar": "ग्याल्पो ल्होसार", "Fagu Purnima (56 Districts)": "फागु पूर्णिमा (५६ जिल्ला)",
                "Fagu Purnima (Remaining Districts)": "फागु पूर्णिमा (बाँकी जिल्ला)", "Gai Jatra (Newars, Kathmandu Valley)": "गाईजात्रा (नेवार समुदाय, काठमाडौं उपत्यका)",
                "Gaura Parva": "गौरा पर्व", "Haritalika (Teej)": "हरितालिका (तीज)", "Jitiya Festival": "जितिया पर्व",
                "Basanta Panchami": "बसन्त पञ्चमी", "Indra Jatra": "इन्द्रजात्रा", "Ghode Jatra": "घोडेजात्रा",
                "May Day": "मे दिवस", "Republic Day": "गणतन्त्र दिवस", "Constitution Day": "संविधान दिवस",
                "Martyrs Day": "शहीद दिवस", "Democracy Day": "प्रजातन्त्र दिवस", "International Women's Day": "अन्तर्राष्ट्रिय महिला दिवस",
                "International Day of Persons with Disabilities": "अन्तर्राष्ट्रिय अपाङ्गता दिवस", "Falgunanda Jayanti (Kirants)": "फाल्गुनन्द जयन्ती (किराँत समुदाय)",
                "Prithvi Jayanti": "पृथ्वी जयन्ती"
            },
            weekdays: {Sun:"आइत",Mon:"सोम",Tue:"मंगल",Wed:"बुध",Thu:"बिही",Fri:"शुक्र",Sat:"शनि"}
        };

        // Initialize
        function init() {
            renderMonthTabs();
            renderCalendar();
            renderMiniCalendars();
            updateMonthFilter();
            updateLanguage();
            bindEvents();
        }

        // Bind events
        function bindEvents() {
            document.getElementDrawer('languageToggle').addEventListener('click', toggleLanguage);
            document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
            document.getElementById('accessNotes').addEventListener('click', showNotes);
            document.getElementById('saveNote').addEventListener('click', saveNote);
            document.getElementById('closeModal').addEventListener('click', closeNotesModal);
            document.getElementById('monthFilter').addEventListener('change', filterNotes);
            document.getElementById('calendarImport').addEventListener('change', importCalendarData);
            document.getElementById('exportNotes').addEventListener('click', exportNotesToExcel);
            document.getElementById('printMonth').addEventListener('click', printCurrentMonthPDF);
            document.getElementById('printYear').addEventListener('click', printFullYearPDF);
            document.getElementById('exportMonth').addEventListener('click', () => exportCalendarToExcel('month'));
            document.getElementById('exportYear').addEventListener('click', () => exportCalendarToExcel('year'));
            document.getElementById('clearNotes').addEventListener('click', clearAllNotes);
        }

        // Render month tabs
        function renderMonthTabs() {
            const tabs = document.getElementById('monthTabs');
            tabs.innerHTML = '';
            calendarData[currentYear].forEach((month, i) => {
                const tab = document.createElement('div');
                tab.className = `month-tab ${i === currentMonth ? 'active' : ''} ${language === 'ne' ? 'nepali' : ''}`;
                tab.textContent = language === 'en' ? month.name : translations.months[month.name];
                tab.addEventListener('click', () => {
                    currentMonth = i;
                    renderMonthTabs();
                    renderCalendar();
                    renderMiniCalendars();
                });
                tabs.appendChild(tab);
            });
        }

        // Render main calendar
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthData = calendarData[currentYear][currentMonth];
            const gregStart = new Date(monthData.gregStart);
            document.getElementById('currentMonth').textContent = `${language === 'en' ? monthData.name : translations.months[monthData.name]} ${currentYear} BS`;
            grid.innerHTML = '';

            const weekdays = language === 'en' ? ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'] : Object.values(translations.weekdays);
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day';
                header.style.backgroundColor = 'var(--secondary)';
                header.style.color = '#fff';
                header.textContent = day;
                if (language === 'ne') header.classList.add('nepali');
                grid.appendChild(header);
            });

            const firstDay = gregStart.getDay();
            for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div').className = 'calendar-day');

            for (let day = 1; day <= monthData.days; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.innerHTML = `
                    <div class="bs-date">${day}</div>
                    <div class="greg-date">${new Date(gregStart.getTime() + (day-1)*86400000).toISOString().split('T')[0]}</div>
                `;
                const dateKey = `${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                if (festivals[dateKey]) {
                    dayDiv.classList.add(festivals[dateKey].class);
                    const festival = document.createElement('div');
                    festival.className = 'festival';
                    festival.textContent = language === 'en' ? festivals[dateKey].name : translations.festivals[festivals[dateKey].name] || festivals[dateKey].name;
                    dayDiv.appendChild(festival);
                    const tooltip = document.createElement('div');
                    tooltip.className = 'festival-tooltip';
                    tooltip.textContent = festival.textContent;
                    dayDiv.appendChild(tooltip);
                }
                const dayNotes = notes.filter(n => n.date === dateKey);
                if (dayNotes.length) {
                    dayDiv.innerHTML += '<div class="note-indicator"></div><div class="note-tooltip">'+dayNotes.map(n => n.title).join(', ')+'</div>';
                }
                dayDiv.addEventListener('click', () => openNoteForm(dateKey, day, monthData.name));
                grid.appendChild(dayDiv);
            }
            document.getElementById('prevMonth').disabled = currentYear === 2081 && currentMonth === 0;
            document.getElementById('nextMonth').disabled = currentYear === 2083 && currentMonth === calendarData[2083].length - 1;
            renderFootnote();
        }

        // Render mini calendars
        function renderMiniCalendars() {
            let prevYear = currentYear, prevMonth = currentMonth - 1;
            if (prevMonth < 0) { prevYear--; prevMonth = calendarData[prevYear]?.length - 1; }
            if (calendarData[prevYear] && prevMonth >= 0) {
                renderMiniCalendar(prevYear, prevMonth, 'miniCalendarGridLeft', 'miniLeftTitle', language === 'en' ? 'Previous Month' : 'अघिल्लो महिना');
            } else {
                document.getElementById('miniCalendarGridLeft').innerHTML = '';
                document.getElementById('miniLeftTitle').textContent = '';
            }
            let nextYear = currentYear, nextMonth = currentMonth + 1;
            if (nextMonth >= calendarData[currentYear].length) { nextYear++; nextMonth = 0; }
            if (calendarData[nextYear]) {
                renderMiniCalendar(nextYear, nextMonth, 'miniCalendarGridRight', 'miniRightTitle', language === 'en' ? 'Next Month' : 'अर्को महिना');
            } else {
                document.getElementById('miniCalendarGridRight').innerHTML = '';
                document.getElementById('miniRightTitle').textContent = '';
            }
        }

        // Render mini calendar
        function renderMiniCalendar(year, month, gridId, titleId, title) {
            const grid = document.getElementById(gridId);
            const monthData = calendarData[year][month];
            const gregStart = new Date(monthData.gregStart);
            document.getElementById(titleId).textContent = `${title}: ${language === 'en' ? monthData.name : translations.months[monthData.name]} ${year}`;
            if (language === 'ne') document.getElementById(titleId).classList.add('nepali');
            grid.innerHTML = '';

            const weekdays = language === 'en' ? ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'] : Object.values(translations.weekdays);
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day';
                header.style.backgroundColor = 'var(--secondary)';
                header.style.color = '#fff';
                header.textContent = day;
                if (language === 'ne') header.classList.add('nepali');
                grid.appendChild(header);
            });

            const firstDay = gregStart.getDay();
            for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div').className = 'calendar-day');

            for (let day = 1; day <= monthData.days; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.innerHTML = `
                    <div class="bs-date">${day}</div>
                    <div class="greg-date">${new Date(gregStart.getTime() + (day-1)*86400000).toISOString().split('T')[0]}</div>
                `;
                const dateKey = `${year}-${(month+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                if (festivals[dateKey]) {
                    dayDiv.classList.add(festivals[dateKey].class);
                    const tooltip = document.createElement('div');
                    tooltip.className = 'festival-tooltip';
                    tooltip.textContent = language === 'en' ? festivals[dateKey].name : translations.festivals[festivals[dateKey].name] || festivals[dateKey].name;
                    dayDiv.appendChild(tooltip);
                }
                const dayNotes = notes.filter(n => n.date === dateKey);
                if (dayNotes.length) {
                    dayDiv.innerHTML += '<div class="note-indicator"></div><div class="note-tooltip">'+dayNotes.map(n => n.title).join(', ')+'</div>';
                }
                grid.appendChild(dayDiv);
            }
        }

        // Render footnote
        function renderFootnote() {
            const list = document.getElementById('holidayList');
            list.innerHTML = '';
            const monthData = calendarData[currentYear][currentMonth];
            for (let day = 1; day <= monthData.days; day++) {
                const dateKey = `${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                if (festivals[dateKey]) {
                    const li = document.createElement('li');
                    li.textContent = `${language === 'en' ? monthData.name : translations.months[monthData.name]} ${day}: ${language === 'en' ? festivals[dateKey].name : translations.festivals[festivals[dateKey].name] || festivals[dateKey].name}`;
                    if (language === 'ne') li.classList.add('nepali');
                    list.appendChild(li);
                }
            }
        }

        // Change month
        function changeMonth(dir) {
            currentMonth += dir;
            if (currentMonth < 0) { currentYear--; currentMonth = calendarData[currentYear].length - 1; }
            else if (currentMonth >= calendarData[currentYear].length) { currentYear++; currentMonth = 0; }
            renderMonthTabs();
            renderCalendar();
            renderMiniCalendars();
        }

        // Toggle language
        function toggleLanguage() {
            language = language === 'en' ? 'ne' : 'en';
            updateLanguage();
            renderMonthTabs();
            renderCalendar();
            renderMiniCalendars();
        }

        // Update language
        function updateLanguage() {
            document.querySelectorAll('[data-en]').forEach(elem => {
                elem.textContent = elem.dataset[language];
                elem.classList.toggle('nepali', language === 'ne');
            });
        }

        // Open note form
        function openNoteForm(dateKey, day, monthName) {
            const form = document.getElementById('noteForm');
            document.getElementById('selectedDate').textContent = `${language === 'en' ? monthName : translations.months[monthName]} ${day}, ${currentYear} BS`;
            form.dataset.date = dateKey;
            form.classList.add('active');
        }

        // Save note
        function saveNote() {
            const form = document.getElementById('noteForm');
            const note = {
                date: form.dataset.date,
                title: document.getElementById('noteTitle').value,
                time: document.getElementById('noteTime').value,
                description: document.getElementById('noteDescription').value
            };
            if (note.title) {
                notes.push(note);
                localStorage.setItem('notes', JSON.stringify(notes));
                form.classList.remove('active');
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteTime').value = '';
                document.getElementById('noteDescription').value = '';
                renderCalendar();
                renderMiniCalendars();
            }
        }

        // Show notes
        function showNotes() {
            document.getElementById('notesModal').style.display = 'block';
            filterNotes();
        }

        // Close notes modal
        function closeNotesModal() {
            document.getElementById('notesModal').style.display = 'none';
        }

        // Update month filter
        function updateMonthFilter() {
            const filter = document.getElementById('monthFilter');
            filter.innerHTML = `<option value="all" data-en="All Months" data-ne="सबै महिनाहरू">${language === 'en' ? 'All Months' : 'सबै महिनाहरू'}</option>`;
            Object.entries(calendarData).forEach(([year, months]) => {
                months.forEach((month, i) => {
                    const opt = document.createElement('option');
                    opt.value = `${year}-${i}`;
                    opt.textContent = `${language === 'en' ? month.name : translations.months[month.name]} ${year}`;
                    if (language === 'ne') opt.classList.add('nepali');
                    filter.appendChild(opt);
                });
            });
        }

        // Filter notes
        function filterNotes() {
            const filter = document.getElementById('monthFilter').value;
            const list = document.getElementById('notesList');
            list.innerHTML = '';
            const filtered = filter === 'all' ? notes : notes.filter(n => n.date.startsWith(filter.replace('-','-')))
            filtered.forEach((note, i) => {
                const item = document.createElement('div');
                item.className = 'note-item';
                item.innerHTML = `
                    <div><strong>${note.title}</strong></div>
                    <div>${note.date} ${note.time ? `at ${note.time}` : ''}</div>
                    <div>${note.description}</div>
                    <div class="note-actions">
                        <span class="edit-note" data-index="${i}">Edit</span>
                        <span class="delete-note" data-index="${i}">Delete</span>
                    </div>
                `;
                item.querySelector('.edit-note').addEventListener('click', () => editNote(i));
                item.querySelector('.delete-note').addEventListener('click', () => deleteNote(i));
                list.appendChild(item);
            });
        }

        // Edit note
        function editNote(index) {
            const note = notes[index];
            openNoteForm(note.date, note.date.split('-')[2], calendarData[currentYear][currentMonth].name);
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteTime').value = note.time;
            document.getElementById('noteDescription').value = note.description;
            notes.splice(index, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        // Delete note
        function deleteNote(index) {
            notes.splice(index, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            filterNotes();
            renderCalendar();
            renderMiniCalendars();
        }

        // Clear all notes
        function clearAllNotes() {
            if (confirm(language === 'en' ? 'Clear all notes?' : 'सबै नोटहरू मेटाउनुहोस्?')) {
                notes = [];
                localStorage.setItem('notes', JSON.stringify(notes));
                filterNotes();
                renderCalendar();
                renderMiniCalendars();
            }
        }

        // Export notes to Excel
        function exportNotesToExcel() {
            if (!window.XLSX) return alert('Excel export not available');
            const ws = XLSX.utils.json_to_sheet(notes, { header: ['date','title','time','description'] });
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Notes');
            XLSX.writeFile(wb, 'Notes.xlsx');
        }

        // Export calendar to Excel
        function exportCalendarToExcel(scope) {
            if (!window.XLSX) return alert('Excel export not available');
            const data = [];
            const months = scope === 'month' ? [calendarData[currentYear][currentMonth]] : calendarData[currentYear];
            months.forEach((month, mIdx) => {
                for (let day = 1; day <= month.days; day++) {
                    const dateKey = `${currentYear}-${(mIdx+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                    const gregDate = new Date(new Date(month.gregStart).getTime() + (day-1)*86400000).toISOString().split('T')[0];
                    const festival = festivals[dateKey] ? festivals[dateKey].name : '';
                    data.push({ Date: dateKey, Gregorian: gregDate, Month: month.name, Day: day, Festival: festival });
                }
            });
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, scope === 'month' ? month.name : 'Year');
            XLSX.writeFile(wb, `${scope === 'month' ? month.name : currentYear}_Calendar.xlsx`);
        }

        // Import calendar data
        function importCalendarData() {
            const file = document.getElementById('calendarImport').files[0];
            if (!file || !window.XLSX) return alert('Excel import not available');
            const reader = new FileReader();
            reader.onload = e => {
                const data = new Uint8Array(e.target.result);
                const wb = XLSX.read(data, { type: 'array', raw: true });
                const ws = wb.Sheets[wb.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(ws);
                notes = json.filter(row => row.date && row.title);
                localStorage.setItem('notes', JSON.stringify(notes));
                filterNotes();
                renderCalendar();
                renderMiniCalendars();
            };
            reader.readAsArrayBuffer(file);
        }

        // Print current month to PDF
        function printCurrentMonthPDF() {
            if (!window.jsPDF) return alert('PDF export not available');
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();
            const monthData = calendarData[currentYear][currentMonth];
            doc.text(`${monthData.name} ${currentYear} BS`, 10, 10);
            let y = 20;
            for (let day = 1; day <= monthData.days; day++) {
                const dateKey = `${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                const gregDate = new Date(new Date(monthData.gregStart).getTime() + (day-1)*86400000).toISOString().split('T')[0];
                const festival = festivals[dateKey] ? festivals[dateKey].name : '';
                doc.text(`${day}: ${gregDate}${festival ? ` - ${festival}` : ''}`, 10, y);
                y += 10;
                if (y > 280) { doc.addPage(); y = 10; }
            }
            doc.save(`${monthData.name}_${currentYear}.pdf`);
        }

        // Print full year to PDF
        function printFullYearPDF() {
            if (!window.jsPDF) return alert('PDF export not available');
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();
            doc.text(`Nepali Calendar ${currentYear} BS`, 10, 10);
            let y = 20;
            calendarData[currentYear].forEach(month => {
                doc.text(`${month.name}`, 10, y);
                y += 10;
                for (let day = 1; day <= month.days; day++) {
                    const dateKey = `${currentYear}-${(calendarData[currentYear].indexOf(month)+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
                    const gregDate = new Date(new Date(month.gregStart).getTime() + (day-1)*86400000).toISOString().split('T')[0];
                    const festival = festivals[dateKey] ? festivals[dateKey].name : '';
                    doc.text(`${day}: ${gregDate}${festival ? ` - ${festival}` : ''}`, 15, y);
                    y += 10;
                    if (y > 280) { doc.addPage(); y = 10; }
                }
                y += 10;
            });
            doc.save(`Calendar_${currentYear}.pdf`);
        }

        // Start
        window.addEventListener('load', init);
    </script>
</body>
</html>
