<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepali Calendar</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
</head>
<body>
    <header>
        <h1 data-en="Nepali Calendar">Nepali Calendar</h1>
    </header>
    <main>
        <section id="calendarSection">
            <div class="controls">
                <select id="yearFilter" aria-label="Select Year"></select>
                <button id="todayButton" data-en="Today">Today</button>
                <button id="languageToggle" data-en="Switch to Nepali">Switch to Nepali</button>
                <button id="themeToggle" data-en="Toggle Theme">Toggle Theme</button>
            </div>
            <h2 id="currentMonth"></h2>
            <div class="nav">
                <button id="prevMonth" aria-label="Previous Month">← Previous</button>
                <button id="nextMonth" aria-label="Next Month">Next →</button>
            </div>
            <div id="monthTabs" role="tablist"></div>
            <div id="calendarGrid" role="grid"></div>
        </section>
        <aside>
            <section>
                <h2 data-en="Today's Date">Today's Date</h2>
                <p><span data-en="Nepali Date">Nepali Date</span>: <span id="todayNepaliDate"></span></p>
                <p><span data-en="English Date">English Date</span>: <span id="todayEnglishDate"></span></p>
            </section>
            <section>
                <h2 data-en="Monthly Summary">Monthly Summary</h2>
                <div id="summaryList"></div>
            </section>
            <section>
                <h2 data-en="Upcoming Reminders">Upcoming Reminders</h2>
                <div id="reminderList"></div>
            </section>
            <section>
                <h2 data-en="Holidays this Month">Holidays this Month</h2>
                <div id="holidayList"></div>
            </section>
            <button id="addBirthdayReminder" data-en="Add Reminder">Add Reminder</button>
            <button id="viewNotes" data-en="View Notes">View Notes</button>
            <button id="viewFinance" data-en="View Reports">View Reports</button>
            <button id="backupData" data-en="Backup Data">Backup Data</button>
            <button id="restoreData" data-en="Restore Data">Restore Data</button>
            <button id="exportExcelMonth" data-en="Export Month to Excel">Export Month to Excel</button>
            <button id="exportPDFMonth" data-en="Export Month to PDF">Export Month to PDF</button>
        </aside>
    </main>
    <div id="noteForm">
        <h2 data-en="Add Entry">Add Entry</h2>
        <form>
            <label for="entryDate"><span data-en="Date">Date</span>:</label>
            <input type="text" id="entryDate" readonly>
            <label for="entryTitle"><span data-en="Title">Title</span>:</label>
            <input type="text" id="entryTitle">
            <label for="entryAmount"><span data-en="Amount">Amount</span>:</label>
            <input type="number" id="entryAmount">
            <label for="entryType"><span data-en="Type">Type</span>:</label>
            <select id="entryType">
                <option value="expense" data-en="Expense">Expense</option>
                <option value="income" data-en="Income">Income</option>
            </select>
            <label for="entryCategory"><span data-en="Category">Category</span>:</label>
            <select id="entryCategory"></select>
            <label><input type="checkbox" id="entryReminder"> <span data-en="Set Reminder">Set Reminder</span></label>
            <input type="datetime-local" id="entryReminderTime" style="display: none;">
            <label><input type="checkbox" id="entryEncrypt"> <span data-en="Encrypt Entry">Encrypt Entry</span></label>
            <button type="button" id="saveNote" data-en="Save">Save</button>
            <button type="button" id="closeEntry" data-en="Close">Close</button>
        </form>
    </div>
    <div id="notesModal">
        <h2 data-en="Notes for this Month">Notes for this Month</h2>
        <div id="notesList"></div>
        <button id="closeModal" data-en="Close">Close</button>
    </div>
    <div id="reportModal">
        <h2 data-en="Financial Reports">Financial Reports</h2>
        <div class="report-tabs" role="tablist">
            <button id="summaryTab" class="report-tab active" role="tab" aria-selected="true" tabindex="0" data-en="Summary">Summary</button>
            <button id="categoryTab" class="report-tab" role="tab" aria-selected="false" tabindex="-1" data-en="Category Breakdown">Category Breakdown</button>
            <button id="trendsTab" class="report-tab" role="tab" aria-selected="false" tabindex="-1" data-en="Trends">Trends</button>
        </div>
        <div id="reportContent"></div>
        <button id="closeReportModal" data-en="Close">Close</button>
    </div>
    <div id="alertMessage" class="alert"></div>
    <input type="file" id="importExcelNotes" style="display: none;" accept=".json">
</body>
</html>