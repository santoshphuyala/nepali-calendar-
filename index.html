<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;
        img-src 'self' blob: data:;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self'
    ">
    <title>Nepali Calendar 2082</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif;
            background-color: #f5f7fa;
        }
        .bg-gradient-primary {
            background: linear-gradient(180deg, #007bff 0%, #0056b3 100%);
            padding: 20px;
        }
        .header-title {
            font-size: 2.5rem;
            margin-bottom: 0;
        }
        .design-credit {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .navbar-nav .nav-link {
            font-weight: 500;
            color: #333;
        }
        .navbar-nav .nav-link.active {
            color: #007bff;
        }
        .year-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            padding: 10px;
        }
        .calendar-day {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
        }
        .calendar-day.holiday {
            background-color: #ffcccc;
        }
        .calendar-day.today {
            background-color: #007bff;
            color: #fff;
        }
        .holiday-list {
            list-style: none;
            padding: 0;
        }
        .holiday-list li {
            padding: 5px 0;
        }
        footer {
            margin-top: 20px;
        }
        .dark-mode {
            background-color: #333;
            color: #fff;
        }
        .dark-mode .calendar-day {
            background-color: #444;
            color: #fff;
        }
        .dark-mode .card {
            background-color: #555;
            color: #fff;
        }
    </style>
</head>
<body>
    <header class="bg-gradient-primary text-white text-center">
        <h1 class="header-title" data-en="Nepali Calendar" data-ne="नेपाली पात्रो">Nepali Calendar</h1>
        <p class="design-credit">Calendar Concept and Design by Santosh Phuyal</p>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="index.html" data-en="Home" data-ne="होम">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="calendar.html" data-en="Calendar" data-ne="पात्रो">Calendar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="finance.html" data-en="Finance" data-ne="वित्त">Finance</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="notes.html" data-en="Notes" data-ne="नोटहरू">Notes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html" data-en="Dashboard" data-ne="ड्यासबोर्ड">Dashboard</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container mt-4">
        <div class="year-filter d-flex flex-wrap justify-content-center gap-2 mb-3">
            <select id="yearSelect" class="form-select w-auto" aria-label="Select Year">
                <option value="2081" data-en="2081 BS" data-ne="2081 BS">2081 BS</option>
                <option value="2082" selected data-en="2082 BS" data-ne="2082 BS">2082 BS</option>
                <option value="2083" data-en="2083 BS" data-ne="2083 BS">2083 BS</option>
            </select>
            <button id="addNote" class="btn btn-primary" data-en="Add Note" data-ne="नोट थप्नुहोस्" aria-label="Add Note">Add Note</button>
            <button id="addFinance" class="btn btn-primary" data-en="Add Finance" data-ne="वित्त थप्नुहोस्" aria-label="Add Finance">Add Finance</button>
            <div class="dropdown">
                <button class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown" data-en="Excel Export" data-ne="एक्सेल निर्यात" aria-label="Excel Export" aria-expanded="false">Excel Export</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item excel-option" href="#" data-type="monthly_calendar" data-en="Monthly Calendar" data-ne="मासिक पात्रो">Monthly Calendar</a></li>
                    <li><a class="dropdown-item excel-option" href="#" data-type="yearly_holidays" data-en="Yearly Holidays" data-ne="वार्षिक बिदाहरू">Yearly Holidays</a></li>
                    <li><a class="dropdown-item excel-option" href="#" data-type="note" data-en="Notes" data-ne="नोटहरू">Notes</a></li>
                    <li><a class="dropdown-item excel-option" href="#" data-type="finance" data-en="Finance" data-ne="वित्त">Finance</a></li>
                </ul>
            </div>
            <div class="dropdown">
                <button class="btn btn-danger dropdown-toggle" data-bs-toggle="dropdown" data-en="PDF Export" data-ne="PDF निर्यात" aria-label="PDF Export" aria-expanded="false">PDF Export</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item pdf-option" href="#" data-type="monthly_calendar" data-en="Monthly Calendar" data-ne="मासिक पात्रो">Monthly Calendar</a></li>
                    <li><a class="dropdown-item pdf-option" href="#" data-type="yearly_holidays" data-en="Yearly Holidays" data-ne="वार्षिक बिदाहरू">Yearly Holidays</a></li>
                    <li><a class="dropdown-item pdf-option" href="#" data-type="note" data-en="Notes" data-ne="नोटहरू">Notes</a></li>
                    <li><a class="dropdown-item pdf-option" href="#" data-type="finance" data-en="Finance" data-ne="वित्त">Finance</a></li>
                </ul>
            </div>
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" data-en="Import" data-ne="आयात" aria-label="Import Data" aria-expanded="false">Import</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item import-option" href="#" data-type="monthly_calendar" data-en="Monthly Calendar" data-ne="मासिक पात्रो">Monthly Calendar</a></li>
                    <li><a class="dropdown-item import-option" href="#" data-type="yearly_holidays" data-en="Yearly Holidays" data-ne="वार्षिक बिदाहरू">Yearly Holidays</a></li>
                    <li><a class="dropdown-item import-option" href="#" data-type="note" data-en="Notes" data-ne="नोटहरू">Notes</a></li>
                    <li><a class="dropdown-item import-option" href="#" data-type="finance" data-en="Finance" data-ne="वित्त">Finance</a></li>
                </ul>
            </div>
            <input type="file" id="restoreFileInput" style="display: none;" accept=".json">
        </div>
        <div class="language-toggle text-center mb-3">
            <button id="languageToggle" class="btn btn-outline-primary" data-en="Toggle Language (EN/NE)" data-ne="भाषा टगल गर्नुहोस् (EN/NE)" aria-label="Toggle Language">Toggle Language (EN/NE)</button>
            <button id="darkModeToggle" class="btn btn-outline-primary ms-2" data-en="Dark Mode" data-ne="डार्क मोड" aria-label="Toggle Dark Mode">Dark Mode</button>
        </div>
        <div class="row">
            <div class="col-12 col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h3 data-en="Calendar 2082 BS" data-ne="पात्रो 2082 BS">Calendar 2082 BS</h3>
                        <ul class="nav nav-tabs" id="monthTabs" role="tablist">
                            <li class="nav-item" role="presentation"><button class="nav-link active" id="baisakh-tab" data-bs-toggle="tab" data-bs-target="#baisakh" type="button" role="tab" aria-controls="baisakh" aria-selected="true" data-en="Baisakh" data-ne="बैशाख">Baisakh</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="jestha-tab" data-bs-toggle="tab" data-bs-target="#jestha" type="button" role="tab" aria-controls="jestha" aria-selected="false" data-en="Jestha" data-ne="जेठ">Jestha</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="ashadh-tab" data-bs-toggle="tab" data-bs-target="#ashadh" type="button" role="tab" aria-controls="ashadh" aria-selected="false" data-en="Ashadh" data-ne="असार">Ashadh</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="shrawan-tab" data-bs-toggle="tab" data-bs-target="#shrawan" type="button" role="tab" aria-controls="shrawan" aria-selected="false" data-en="Shrawan" data-ne="श्रावण">Shrawan</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="bhadra-tab" data-bs-toggle="tab" data-bs-target="#bhadra" type="button" role="tab" aria-controls="bhadra" aria-selected="false" data-en="Bhadra" data-ne="भदौ">Bhadra</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="asoj-tab" data-bs-toggle="tab" data-bs-target="#asoj" type="button" role="tab" aria-controls="asoj" aria-selected="false" data-en="Asoj" data-ne="आश्विन">Asoj</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="kartik-tab" data-bs-toggle="tab" data-bs-target="#kartik" type="button" role="tab" aria-controls="kartik" aria-selected="false" data-en="Kartik" data-ne="कार्तिक">Kartik</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="mangsir-tab" data-bs-toggle="tab" data-bs-target="#mangsir" type="button" role="tab" aria-controls="mangsir" aria-selected="false" data-en="Mangsir" data-ne="मंसिर">Mangsir</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="poush-tab" data-bs-toggle="tab" data-bs-target="#poush" type="button" role="tab" aria-controls="poush" aria-selected="false" data-en="Poush" data-ne="पौष">Poush</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="magh-tab" data-bs-toggle="tab" data-bs-target="#magh" type="button" role="tab" aria-controls="magh" aria-selected="false" data-en="Magh" data-ne="माघ">Magh</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="falgun-tab" data-bs-toggle="tab" data-bs-target="#falgun" type="button" role="tab" aria-controls="falgun" aria-selected="false" data-en="Falgun" data-ne="फाल्गुन">Falgun</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" id="chaitra-tab" data-bs-toggle="tab" data-bs-target="#chaitra" type="button" role="tab" aria-controls="chaitra" aria-selected="false" data-en="Chaitra" data-ne="चैत">Chaitra</button></li>
                        </ul>
                        <div class="tab-content" id="monthTabContent">
                            <div class="tab-pane fade show active" id="baisakh" role="tabpanel" aria-labelledby="baisakh-tab">
                                <div class="calendar-grid" id="calendarGridBaisakh"></div>
                            </div>
                            <div class="tab-pane fade" id="jestha" role="tabpanel" aria-labelledby="jestha-tab">
                                <div class="calendar-grid" id="calendarGridJestha"></div>
                            </div>
                            <div class="tab-pane fade" id="ashadh" role="tabpanel" aria-labelledby="ashadh-tab">
                                <div class="calendar-grid" id="calendarGridAshadh"></div>
                            </div>
                            <div class="tab-pane fade" id="shrawan" role="tabpanel" aria-labelledby="shrawan-tab">
                                <div class="calendar-grid" id="calendarGridShrawan"></div>
                            </div>
                            <div class="tab-pane fade" id="bhadra" role="tabpanel" aria-labelledby="bhadra-tab">
                                <div class="calendar-grid" id="calendarGridBhadra"></div>
                            </div>
                            <div class="tab-pane fade" id="asoj" role="tabpanel" aria-labelledby="asoj-tab">
                                <div class="calendar-grid" id="calendarGridAsoj"></div>
                            </div>
                            <div class="tab-pane fade" id="kartik" role="tabpanel" aria-labelledby="kartik-tab">
                                <div class="calendar-grid" id="calendarGridKartik"></div>
                            </div>
                            <div class="tab-pane fade" id="mangsir" role="tabpanel" aria-labelledby="mangsir-tab">
                                <div class="calendar-grid" id="calendarGridMangsir"></div>
                            </div>
                            <div class="tab-pane fade" id="poush" role="tabpanel" aria-labelledby="poush-tab">
                                <div class="calendar-grid" id="calendarGridPoush"></div>
                            </div>
                            <div class="tab-pane fade" id="magh" role="tabpanel" aria-labelledby="magh-tab">
                                <div class="calendar-grid" id="calendarGridMagh"></div>
                            </div>
                            <div class="tab-pane fade" id="falgun" role="tabpanel" aria-labelledby="falgun-tab">
                                <div class="calendar-grid" id="calendarGridFalgun"></div>
                            </div>
                            <div class="tab-pane fade" id="chaitra" role="tabpanel" aria-labelledby="chaitra-tab">
                                <div class="calendar-grid" id="calendarGridChaitra"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h3 data-en="Holidays in 2082 BS" data-ne="2082 BS मा बिदाहरू">Holidays in 2082 BS</h3>
                        <ul class="holiday-list" id="holidayList"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="noteFormModal" tabindex="-1" aria-labelledby="noteFormTitle" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="noteFormTitle"><span data-en="Add Entry for" data-ne="प्रवेश थप्नुहोस्">Add Entry for</span> <span id="selectedDate">Date</span></h5>
                    <button type="button" class="btn-close" id="closeEntry" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select id="entryType" class="form-select mb-3" aria-label="Entry Type">
                        <option value="note" data-en="Note" data-ne="नोट">Note</option>
                        <option value="income" data-en="Income" data-ne="आय">Income</option>
                        <option value="expense" data-en="Expense" data-ne="खर्च">Expense</option>
                    </select>
                    <input type="text" id="noteTitle" class="form-control mb-3" placeholder="Note Title / Amount" data-en="Note Title / Amount" data-ne="नोट शीर्षक / रकम" aria-label="Note Title or Amount">
                    <input type="time" id="noteTime" class="form-control mb-3" aria-label="Note Time">
                    <textarea id="noteDescription" class="form-control mb-3" placeholder="Description" data-en="Description" data-ne="विवरण" rows="3" aria-label="Description"></textarea>
                    <select id="entryCategory" class="form-select mb-3" style="display:none" aria-label="Category">
                        <option value="" data-en="Select Category" data-ne="श्रेणी चयन गर्नुहोस्">Select Category</option>
                        <option value="Food" data-en="Food" data-ne="खाना">Food</option>
                        <option value="Salary" data-en="Salary" data-ne="तलब">Salary</option>
                        <option value="Rent" data-en="Rent" data-ne="भाडा">Rent</option>
                        <option value="Utilities" data-en="Utilities" data-ne="उपयोगिताहरू">Utilities</option>
                        <option value="Transport" data-en="Transport" data-ne="यातायात">Transport</option>
                        <option value="Entertainment" data-en="Entertainment" data-ne="मनोरञ्जन">Entertainment</option>
                        <option value="Freelance" data-en="Freelance" data-ne="फ्रीलान्स">Freelance</option>
                        <option value="Other" data-en="Other" data-ne="अन्य">Other</option>
                    </select>
                    <div class="category-manager mb-3" id="categoryManager" style="display:none">
                        <input type="text" id="newCategory" class="form-control d-inline-block w-75" placeholder="New Category" data-en="New Category" data-ne="नयाँ श्रेणी" aria-label="New Category">
                        <button id="addCategory" class="btn btn-success" data-en="Add Category" data-ne="श्रेणी थप्नुहोस्" aria-label="Add Category">Add Category</button>
                    </div>
                    <div class="mb-3" id="budgetSection" style="display:none">
                        <input type="number" id="monthlyBudget" class="form-control" placeholder="Monthly Budget (NPR)" data-en="Monthly Budget (NPR)" data-ne="मासिक बजेट (NPR)" aria-label="Monthly Budget">
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" id="recurring" class="form-check-input" aria-label="Recurring Monthly">
                        <label class="form-check-label" data-en="Recurring Monthly" data-ne="मासिक दोहोरिने">Recurring Monthly</label>
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" id="reminder" class="form-check-input" aria-label="Set Reminder">
                        <label class="form-check-label" data-en="Set Reminder" data-ne="रिमाइन्डर सेट गर्नुहोस्">Set Reminder</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveNote" class="btn btn-primary" data-en="Save Entry" data-ne="प्रवेश बचत गर्नुहोस्" aria-label="Save Entry">Save Entry</button>
                    <button id="editEntry" class="btn btn-success" data-en="Edit Entry" data-ne="प्रवेश सम्पादन गर्नुहोस्" aria-label="Edit Entry" style="display:none">Edit Entry</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="bg-light text-center py-3">
        <p class="design-credit">Calendar Concept and Design by Santosh Phuyal</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Calendar Data
            const calendarData = {
                2081: [
                    {name:"Baisakh",days:31,gregStart:"2024-04-13"},
                    {name:"Jestha",days:32,gregStart:"2024-05-14"},
                    {name:"Ashadh",days:31,gregStart:"2024-06-15"},
                    {name:"Shrawan",days:32,gregStart:"2024-07-16"},
                    {name:"Bhadra",days:31,gregStart:"2024-08-17"},
                    {name:"Asoj",days:31,gregStart:"2024-09-17"},
                    {name:"Kartik",days:30,gregStart:"2024-10-18"},
                    {name:"Mangsir",days:29,gregStart:"2024-11-17"},
                    {name:"Poush",days:30,gregStart:"2024-12-16"},
                    {name:"Magh",days:29,gregStart:"2025-01-15"},
                    {name:"Falgun",days:30,gregStart:"2025-02-13"},
                    {name:"Chaitra",days:30,gregStart:"2025-03-15"}
                ],
                2082: [
                    {name:"Baisakh",days:31,gregStart:"2025-04-14"},
                    {name:"Jestha",days:31,gregStart:"2025-05-15"},
                    {name:"Ashadh",days:32,gregStart:"2025-06-15"},
                    {name:"Shrawan",days:31,gregStart:"2025-07-17"},
                    {name:"Bhadra",days:31,gregStart:"2025-08-17"},
                    {name:"Asoj",days:31,gregStart:"2025-09-17"},
                    {name:"Kartik",days:30,gregStart:"2025-10-18"},
                    {name:"Mangsir",days:29,gregStart:"2025-11-17"},
                    {name:"Poush",days:30,gregStart:"2025-12-16"},
                    {name:"Magh",days:29,gregStart:"2026-01-15"},
                    {name:"Falgun",days:30,gregStart:"2026-02-13"},
                    {name:"Chaitra",days:31,gregStart:"2026-03-16"}
                ],
                2083: [
                    {name:"Baisakh",days:31,gregStart:"2026-04-14"},
                    {name:"Jestha",days:32,gregStart:"2026-05-15"},
                    {name:"Ashadh",days:31,gregStart:"2026-06-16"},
                    {name:"Shrawan",days:31,gregStart:"2026-07-17"},
                    {name:"Bhadra",days:31,gregStart:"2026-08-17"},
                    {name:"Asoj",days:30,gregStart:"2026-09-17"},
                    {name:"Kartik",days:30,gregStart:"2026-10-17"},
                    {name:"Mangsir",days:30,gregStart:"2026-11-16"},
                    {name:"Poush",days:29,gregStart:"2026-12-16"},
                    {name:"Magh",days:30,gregStart:"2027-01-14"},
                    {name:"Falgun",days:30,gregStart:"2027-02-13"},
                    {name:"Chaitra",days:31,gregStart:"2027-03-15"}
                ]
            };

            // Holidays Data
            const holidays = {
                2081: [
                    { month: 6, day: 1, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 6, day: 15, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 11, day: 1, name: "Chaitra Navaratri", nepali: "चैत्र नवरात्री", type: "national" }
                ],
                2082: [
                    { month: 0, day: 1, name: "Nepali New Year", nepali: "नेपाली नयाँ वर्ष", type: "national" },
                    { month: 0, day: 5, name: "Ram Navami", nepali: "राम नवमी", type: "national" },
                    { month: 0, day: 29, name: "Ubauli Parva", nepali: "उबौली पर्व", type: "ethnic" },
                    { month: 0, day: 29, name: "Buddha Jayanti", nepali: "बुद्ध जयन्ती", type: "birth" },
                    { month: 0, day: 18, name: "May Day Labour Day", nepali: "मे दिवस", type: "observed" },
                    { month: 1, day: 15, name: "Republic Day", nepali: "गणतन्त्र दिवस", type: "observed" },
                    { month: 3, day: 24, name: "Rakshya Bandhan", nepali: "रक्षा बन्धन", type: "national" },
                    { month: 3, day: 25, name: "Gai Jatra", nepali: "गाईजात्रा", type: "jatra" },
                    { month: 3, day: 25, name: "Gaijatra", nepali: "गाईजात्रा", type: "ethnic" },
                    { month: 3, day: 31, name: "Krishna Janmashtami", nepali: "कृष्ण जन्माष्टमी", type: "national" },
                    { month: 4, day: 10, name: "Haritalika (Teej)", nepali: "हरितालिका (तीज)", type: "women" },
                    { month: 4, day: 15, name: "Gaura Parva", nepali: "गौरा पर्व", type: "ethnic" },
                    { month: 4, day: 21, name: "Indra Jatra", nepali: "इन्द्रजात्रा", type: "jatra" },
                    { month: 4, day: 30, name: "Jitiya Festival", nepali: "जितिया पर्व", type: "women" },
                    { month: 5, day: 3, name: "Constitution Day", nepali: "संविधान दिवस", type: "observed" },
                    { month: 5, day: 6, name: "Ghatasthapana", nepali: "घटस्थापना", type: "national" },
                    { month: 5, day: 13, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 14, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 15, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 16, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 17, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 18, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 6, day: 3, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 6, day: 4, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 6, day: 5, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 6, day: 6, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 6, day: 7, name: "Tihar", nepali: "तिहार", type: "tihar" },
                    { month: 6, day: 10, name: "Chhath", nepali: "छठ", type: "national" },
                    { month: 6, day: 25, name: "Falgunanda Jayanti", nepali: "फाल्गुनन्द जयन्ती", type: "birth" },
                    { month: 7, day: 17, name: "International Day of Persons with Disabilities", nepali: "अन्तर्राष्ट्रिय अपाङ्गता दिवस", type: "disability" },
                    { month: 7, day: 18, name: "Udhauli Parva, Yomari Punhi", nepali: "उधौली पर्व, योमरी पुन्ही", type: "national" },
                    { month: 8, day: 10, name: "Christmas", nepali: "क्रिसमस", type: "national" },
                    { month: 8, day: 15, name: "Tamu Lhosar", nepali: "तमु ल्होसार", type: "national" },
                    { month: 8, day: 27, name: "Prithvi Jayanti", nepali: "पृथ्वी जयन्ती", type: "birth" },
                    { month: 9, day: 1, name: "Maghi Parva/Maghe Sankranti", nepali: "माघी पर्व/माघे संक्रान्ति", type: "national" },
                    { month: 9, day: 5, name: "Sonam Lhosar", nepali: "सोनाम ल्होसार", type: "national" },
                    { month: 9, day: 9, name: "Basanta Panchami/Saraswati Puja", nepali: "बसन्त पञ्चमी/सरस्वती पूजा", type: "education" },
                    { month: 9, day: 16, name: "Martyrs Day", nepali: "शहीद दिवस", type: "observed" },
                    { month: 10, day: 3, name: "Maha Shivaratri", nepali: "महाशिवरात्रि", type: "national" },
                    { month: 10, day: 6, name: "Gyalpo Lhosar", nepali: "ग्याल्पो ल्होसार", type: "national" },
                    { month: 10, day: 7, name: "Democracy Day", nepali: "प्रजातन्त्र दिवस", type: "observed" },
                    { month: 10, day: 18, name: "Fagu Purnima", nepali: "फागु पूर्णिमा", type: "national" },
                    { month: 10, day: 24, name: "International Women's Day", nepali: "अन्तर्राष्ट्रिय महिला दिवस", type: "observed" },
                    { month: 11, day: 1, name: "Fagu Purnima", nepali: "फागु पूर्णिमा", type: "national" },
                    { month: 11, day: 4, name: "Ghode Jatra", nepali: "घोडेजात्रा", type: "jatra" }
                ],
                2083: [
                    { month: 0, day: 1, name: "Nepali New Year", nepali: "नेपाली नयाँ वर्ष", type: "national" },
                    { month: 5, day: 15, name: "Dashain", nepali: "दशैं", type: "dashain" },
                    { month: 5, day: 29, name: "Tihar", nepali: "तिहार", type: "tihar" }
                ]
            };

            // Initialize State
            let currentYear = 2082;
            let currentMonthIndex = 0;
            let isNepali = false;
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            let customCategories = JSON.parse(localStorage.getItem('customCategories')) || [];
            let budgets = JSON.parse(localStorage.getItem('budgets')) || {};
            let editingNoteIndex = null;
            let undoStack = [];

            // Language Data
            const monthsNepali = ['बैशाख', 'जेठ', 'असार', 'श्रावण', 'भदौ', 'आश्विन', 'कार्तिक', 'मंसिर', 'पौष', 'माघ', 'फाल्गुन', 'चैत'];
            const daysNepali = ['आइतबार', 'सोमबार', 'मंगलबार', 'बुधबार', 'बिहीबार', 'शुक्रबार', 'शनिबार'];
            const daysEnglish = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            // DOM Elements
            const noteFormModal = new bootstrap.Modal(document.getElementById('noteFormModal'));
            const entryType = document.getElementById('entryType');
            const noteTitle = document.getElementById('noteTitle');
            const noteTime = document.getElementById('noteTime');
            const noteDescription = document.getElementById('noteDescription');
            const entryCategory = document.getElementById('entryCategory');
            const newCategory = document.getElementById('newCategory');
            const addCategory = document.getElementById('addCategory');
            const categoryManager = document.getElementById('categoryManager');
            const budgetSection = document.getElementById('budgetSection');
            const monthlyBudget = document.getElementById('monthlyBudget');
            const recurring = document.getElementById('recurring');
            const reminder = document.getElementById('reminder');
            const saveNote = document.getElementById('saveNote');
            const editEntry = document.getElementById('editEntry');
            const closeEntry = document.getElementById('closeEntry');
            const selectedDate = document.getElementById('selectedDate');

            // Function to Calculate Start Day from gregStart
            function getStartDay(gregStart) {
                const date = new Date(gregStart);
                return date.getDay(); // 0 (Sunday) to 6 (Saturday)
            }

            // Render Calendar Grid
            function renderCalendar(year, monthIndex) {
                const monthData = calendarData[year][monthIndex];
                const monthName = monthData.name; // Now matches HTML IDs (e.g., "Baisakh")
                const grid = document.getElementById(`calendarGrid${monthName}`);
                if (!grid) {
                    console.error(`Calendar grid for ${monthName} not found`);
                    return;
                }
                console.log(`Rendering calendar for ${monthName}, ${year}`);
                grid.innerHTML = '';

                // Add day labels
                const days = isNepali ? daysNepali : daysEnglish;
                days.forEach(day => {
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'calendar-day';
                    dayLabel.textContent = day;
                    grid.appendChild(dayLabel);
                });

                // Calculate start day
                const startDay = getStartDay(monthData.gregStart);
                console.log(`Start day for ${monthName}: ${startDay}`);

                // Add empty days before the start of the month
                for (let i = 0; i < startDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    grid.appendChild(emptyDay);
                }

                // Add days of the month
                const today = new Date();
                const gregStartDate = new Date(monthData.gregStart);
                const todayNepali = { year: 2082, monthIndex: 0, date: 1 }; // Simplified for demo (adjust based on actual date conversion)
                for (let i = 1; i <= monthData.days; i++) {
                    const day = document.createElement('div');
                    day.className = 'calendar-day';
                    day.textContent = isNepali ? i.toString().replace(/[0-9]/g, d => String.fromCharCode(0x0966 + parseInt(d))) : i;
                    const dayHolidays = holidays[year]?.filter(h => h.month === monthIndex && h.day === i);
                    if (dayHolidays && dayHolidays.length > 0) {
                        day.classList.add('holiday');
                        day.title = dayHolidays.map(h => isNepali ? h.nepali : h.name).join(', ');
                    }
                    if (year === todayNepali.year && monthIndex === todayNepali.monthIndex && i === todayNepali.date) {
                        day.classList.add('today');
                    }
                    day.addEventListener('click', () => {
                        selectedDate.textContent = `${isNepali ? monthsNepali[monthIndex] : monthData.name} ${i}, ${year}`;
                        noteFormModal.show();
                    });
                    grid.appendChild(day);
                }
            }

            // Render Holidays
            function renderHolidays(year) {
                const holidayList = document.getElementById('holidayList');
                if (!holidayList) {
                    console.error('Holiday list element not found');
                    return;
                }
                holidayList.innerHTML = '';
                console.log(`Rendering holidays for year ${year}:`, holidays[year]);
                if (!holidays[year] || holidays[year].length === 0) {
                    const li = document.createElement('li');
                    li.textContent = isNepali ? 'कुनै बिदा छैन' : 'No holidays';
                    holidayList.appendChild(li);
                    return;
                }
                holidays[year].forEach(holiday => {
                    const monthName = isNepali ? monthsNepali[holiday.month] : calendarData[year][holiday.month].name;
                    const li = document.createElement('li');
                    li.textContent = `${monthName} ${holiday.day}: ${isNepali ? holiday.nepali : holiday.name}`;
                    holidayList.appendChild(li);
                });
            }

            // Initialize Calendar
            function initializeCalendar(year) {
                console.log(`Initializing calendar for year ${year}`);
                calendarData[year].forEach((month, index) => {
                    console.log(`Calling renderCalendar for month ${month.name}, index ${index}`);
                    renderCalendar(year, index);
                });
                renderHolidays(year);
                document.querySelector('h3[data-en="Calendar 2082 BS"]').textContent = isNepali ? `पात्रो ${year} BS` : `Calendar ${year} BS`;
                document.querySelector('h3[data-en="Holidays in 2082 BS"]').textContent = isNepali ? `${year} BS मा बिदाहरू` : `Holidays in ${year} BS`;
            }

            // Year Change Handler
            document.getElementById('yearSelect').addEventListener('change', (e) => {
                currentYear = parseInt(e.target.value);
                initializeCalendar(currentYear);
            });

            // Language Toggle
            document.getElementById('languageToggle').addEventListener('click', () => {
                isNepali = !isNepali;
                document.querySelectorAll('[data-en]').forEach(elem => {
                    elem.textContent = isNepali ? elem.getAttribute('data-ne') : elem.getAttribute('data-en');
                });
                initializeCalendar(currentYear);
            });

            // Dark Mode Toggle
            document.getElementById('darkModeToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
            });

            // Add Note and Finance
            document.getElementById('addNote').addEventListener('click', () => {
                entryType.value = 'note';
                selectedDate.textContent = 'Today';
                noteFormModal.show();
            });

            document.getElementById('addFinance').addEventListener('click', () => {
                entryType.value = 'income';
                selectedDate.textContent = 'Today';
                noteFormModal.show();
            });

            // Entry Type Change Handler
            entryType.addEventListener('change', () => {
                const type = entryType.value;
                if (type === 'note') {
                    entryCategory.style.display = 'none';
                    categoryManager.style.display = 'none';
                    budgetSection.style.display = 'none';
                } else {
                    entryCategory.style.display = 'block';
                    categoryManager.style.display = 'block';
                    budgetSection.style.display = 'block';
                    // Populate custom categories
                    customCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        entryCategory.appendChild(option);
                    });
                }
            });

            // Add Category
            addCategory.addEventListener('click', () => {
                const category = newCategory.value.trim();
                if (category && !customCategories.includes(category)) {
                    customCategories.push(category);
                    localStorage.setItem('customCategories', JSON.stringify(customCategories));
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    entryCategory.appendChild(option);
                    newCategory.value = '';
                }
            });

            // Save Note
            saveNote.addEventListener('click', () => {
                const entry = {
                    type: entryType.value,
                    title: noteTitle.value,
                    time: noteTime.value,
                    description: noteDescription.value,
                    category: entryCategory.value,
                    date: selectedDate.textContent,
                    recurring: recurring.checked,
                    reminder: reminder.checked,
                    year: currentYear,
                    month: currentMonthIndex
                };
                if (editingNoteIndex !== null) {
                    notes[editingNoteIndex] = entry;
                    editingNoteIndex = null;
                    editEntry.style.display = 'none';
                } else {
                    notes.push(entry);
                    undoStack.push({ action: 'add', note: entry });
                }
                localStorage.setItem('notes', JSON.stringify(notes));
                if (entry.type !== 'note') {
                    const budget = parseFloat(monthlyBudget.value) || 0;
                    budgets[`${currentYear}-${currentMonthIndex}`] = budget;
                    localStorage.setItem('budgets', JSON.stringify(budgets));
                }
                noteFormModal.hide();
                noteTitle.value = '';
                noteTime.value = '';
                noteDescription.value = '';
                recurring.checked = false;
                reminder.checked = false;
                monthlyBudget.value = '';
            });

            // Close Modal
            closeEntry.addEventListener('click', () => {
                noteFormModal.hide();
            });

            // Export Functionality
            document.querySelectorAll('.excel-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = e.target.getAttribute('data-type');
                    let data = [];
                    if (type === 'monthly_calendar') {
                        data = calendarData[currentYear].map((month, index) => ({
                            Month: isNepali ? monthsNepali[index] : month.name,
                            Days: month.days,
                            StartDate: month.gregStart
                        }));
                    } else if (type === 'yearly_holidays') {
                        data = holidays[currentYear]?.map(h => ({
                            Month: isNepali ? monthsNepali[h.month] : calendarData[currentYear][h.month].name,
                            Day: h.day,
                            Name: isNepali ? h.nepali : h.name
                        })) || [];
                    } else if (type === 'note' || type === 'finance') {
                        data = notes.filter(n => type === 'note' ? n.type === 'note' : (n.type === 'income' || n.type === 'expense')).map(n => ({
                            Date: n.date,
                            Type: n.type,
                            Title: n.title,
                            Description: n.description,
                            Category: n.category || ''
                        }));
                    }
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, type);
                    XLSX.writeFile(wb, `${type}.xlsx`);
                });
            });

            document.querySelectorAll('.pdf-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    const type = e.target.getAttribute('data-type');
                    doc.text(`Export: ${type}`, 10, 10);
                    if (type === 'monthly_calendar') {
                        calendarData[currentYear].forEach((month, index) => {
                            doc.text(`${isNepali ? monthsNepali[index] : month.name}: ${month.days} days, Starts: ${month.gregStart}`, 10, 20 + index * 10);
                        });
                    } else if (type === 'yearly_holidays') {
                        holidays[currentYear]?.forEach((h, index) => {
                            doc.text(`${isNepali ? monthsNepali[h.month] : calendarData[currentYear][h.month].name} ${h.day}: ${isNepali ? h.nepali : h.name}`, 10, 20 + index * 10);
                        });
                    }
                    doc.save(`${type}.pdf`);
                });
            });

            // Import Functionality
            document.querySelectorAll('.import-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = e.target.getAttribute('data-type');
                    const fileInput = document.getElementById('restoreFileInput');
                    fileInput.setAttribute('data-import-type', type);
                    fileInput.click();
                });
            });

            document.getElementById('restoreFileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const data = JSON.parse(event.target.result);
                        const type = e.target.getAttribute('data-import-type');
                        if (type === 'note' || type === 'finance') {
                            notes = notes.concat(data);
                            localStorage.setItem('notes', JSON.stringify(notes));
                        }
                        console.log(`Imported ${type}:`, data);
                    };
                    reader.readAsText(file);
                }
            });

            // Initialize
            initializeCalendar(currentYear);
        });
    </script>
</body>
</html>
